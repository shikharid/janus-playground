parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"zmNJ":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function u(e){try{a(i.next(e))}catch(e){o(e)}}function s(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(u,s)}a((i=i.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,i,r,o,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,i=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){u.label=o[1];break}if(6===o[0]&&u.label<r[1]){u.label=r[1],r=o;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(o);break}r[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(e,u)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.userMedia=exports.UserMedia=void 0;var n=function(){function n(){}return n.prototype.mediaConstraints=function(){return{audio:this.audioConstraints(),video:this.videoConstraints()}},n.prototype.audioConstraints=function(){return this.audioDeviceId?{deviceId:this.audioDeviceId}:(console.error("no audio device selected"),!1)},n.prototype.videoConstraints=function(){return this.videoDeviceId?{deviceId:this.videoDeviceId,height:480,width:640}:(console.error("no video device selected"),!1)},n.prototype.videoDevices=function(){return e(this,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return[4,this.getConsent()];case 1:return e.sent(),[2,navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"videoinput"===e.kind})})]}})})},n.prototype.audioInDevices=function(){return e(this,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return[4,this.getConsent()];case 1:return e.sent(),[2,navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"audioinput"===e.kind})})]}})})},n.prototype.audioOutDevices=function(){return e(this,void 0,void 0,function(){return t(this,function(e){switch(e.label){case 0:return[4,this.getConsent()];case 1:return e.sent(),[2,navigator.mediaDevices.enumerateDevices().then(function(e){return e.filter(function(e){return"audiooutput"===e.kind})})]}})})},n.prototype.getConsent=function(){return e(this,void 0,void 0,function(){return t(this,function(e){return[2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(e){return e.getTracks().forEach(function(e){return e.stop()})})]})})},n}();exports.UserMedia=n,exports.userMedia=new n,window.umedia=exports.userMedia;
},{}],"UnXq":[function(require,module,exports) {
"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function o(){return"4xxx-yxxx-xxxxxxx".replace(/[xy]/g,function(t){var o=16*Math.random()|0;return("x"==t?o:3&o|8).toString(16)})}function r(t){return new Promise(function(o,r){setTimeout(function(){return r("request timed out")},t)})}function e(o){return"object"===(void 0===o?"undefined":t(o))?JSON.stringify(o,null,4):o}function n(){var t=["java","flock","js","python"],o=["noob","ninja","monkey"];return t[Math.floor(Math.random()*t.length)]+"-"+o[Math.floor(Math.random()*o.length)]}Object.defineProperty(exports,"__esModule",{value:!0}),exports.rUsername=exports.prettifyJson=exports.autoExpiringPromise=exports.tid=void 0,exports.tid=o,exports.autoExpiringPromise=r,exports.prettifyJson=e,exports.rUsername=n;
},{}],"0xjy":[function(require,module,exports) {
"use strict";function e(e){return document.getElementById(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.unhideEl=exports.hideEl=exports.stats=exports.statsDiv=exports.signalLog=exports.removeRemoteVid=exports.remoteVideoDisplayer=exports.username=exports.remoteStreamDiv=exports.localStreamVid=exports.progressBar=exports.joinBtn=exports.videoSelect=exports.audioSelect=exports.roomDiv=exports.constraintsDiv=exports.getEl=void 0,exports.getEl=e,exports.constraintsDiv=e("constraint-div"),exports.roomDiv=e("room-div"),exports.audioSelect=e("audioSource"),exports.videoSelect=e("videoSource"),exports.joinBtn=e("join-room-btn"),exports.progressBar=e("progress-bar"),exports.localStreamVid=e("local-stream"),exports.remoteStreamDiv=e("remote-streams"),exports.username=e("username");var t=new Map;function o(e){var t=document.createElement("video");return exports.localStreamVid.getAttribute("pid")===e&&(t.muted=!0),t.autoplay=!0,t.height=240,t.width=320,t.setAttribute("style","margin-bottom: 0;"),t.setAttribute("playsinline","true"),t.classList.add("responsive-video"),t}function r(){return document.createElement("pre")}function s(e){if(!t.has(e)){var s=o(e),i=r(),a=document.createElement("div");a.classList.add("video-box"),a.classList.add("col"),a.classList.add("l4"),a.appendChild(s),a.appendChild(i),a.id=e;var n={videoEl:s,info:i,div:a};t.set(e,n),exports.remoteStreamDiv.appendChild(a)}return t.get(e)}function i(e){var o=t.get(e);o&&exports.remoteStreamDiv.removeChild(o.div)}exports.remoteVideoDisplayer=s,exports.removeRemoteVid=i;var a=e("signal-log"),n=[];function d(e){var t=(new Date).toLocaleTimeString();a.insertAdjacentText("afterbegin","["+t+"] "+e+"\n\n")}function p(e){e.classList.add("hidden")}function l(e){e.classList.remove("hidden")}exports.signalLog=d,exports.statsDiv=e("stats-div"),exports.stats=e("stats"),exports.hideEl=p,exports.unhideEl=l;
},{}],"zye4":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TEST_ROOM_ID=exports.JANUS_WS=exports.JANUS_BASE=void 0,exports.JANUS_BASE="https://ec2-3-7-218-198.ap-south-1.compute.amazonaws.com:8089/",exports.JANUS_WS="wss://ec2-3-7-218-198.ap-south-1.compute.amazonaws.com:8989/",exports.TEST_ROOM_ID=1234;
},{}],"IHrt":[function(require,module,exports) {
"use strict";function e(e){return void 0!==e.session_id}function s(e){return n(e)||i(e)}function n(s){return e(s)&&void 0!==s.handle_id}function i(s){return e(s)&&void 0!==s.sender}function t(e){return s(e)&&void 0!==e.janus}Object.defineProperty(exports,"__esModule",{value:!0}),exports.isJanusEvent=exports.isHandleMessageWithSender=exports.isHandleMessageWithId=exports.isHandleMessage=exports.isSessionMessage=void 0,exports.isSessionMessage=e,exports.isHandleMessage=s,exports.isHandleMessageWithId=n,exports.isHandleMessageWithSender=i,exports.isJanusEvent=t;
},{}],"RJfL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PluginHandle=void 0;var e=require("../utils"),s=require("./types/Messages"),n=function(){function n(e,s){this.handleId=e,this.session=s,this.eventListeners=new Map}return n.prototype.setEventListener=function(e,s){this.eventListeners.set(e,s)},n.prototype.detach=function(){return this.session.detachHandle(this)},n.prototype.send=function(s,n){var t={body:s,janus:"message",jsep:n,handle_id:this.handleId,session_id:this.session.sessionId};return this.logOutgoing("sending req \n \t body: "+e.prettifyJson(s)+" \n \t jsep: "+e.prettifyJson(n)),this.session.send(t)},n.prototype.receive=function(n){if(s.isJanusEvent(n)){var t=this.eventListeners.get(n.janus);t?t.onEvent(n):this.logIncoming("unhandled EVENT "+e.prettifyJson(n))}else this.logIncoming("unhandled MESSAGE "+e.prettifyJson(n))},n.prototype.logIncoming=function(e){console.debug("JANUS => session "+this.session.sessionId+" => handle "+this.handleId+" => "+e)},n.prototype.logOutgoing=function(e){console.debug("JANUS <= session "+this.session.sessionId+" <= handle "+this.handleId+" <= "+e)},n}();exports.PluginHandle=n;
},{"../utils":"UnXq","./types/Messages":"IHrt"}],"9t1e":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Session=void 0;var e=require("./Janus"),s=require("./PluginHandle"),n=require("../utils"),i=require("./types/Messages"),t=function(){function t(e){this.sessionId=e,this.handles=new Map,this.keepSessionAlive()}return t.prototype.createHandle=function(e){var n=this;void 0===e&&(e="janus.plugin.videoroom");var i={janus:"attach",plugin:e,session_id:this.sessionId};return this.send(i).then(function(e){var i=new s.PluginHandle(e.data.id,n);return n.handles.set(i.handleId,i),i})},t.prototype.send=function(s){return s.session_id=this.sessionId,this.logOutgoing("sending req "+n.prettifyJson(s)),e.janus.send(s)},t.prototype.receive=function(e){var s=this,t=function(){return s.logIncoming("unhandled msg "+n.prettifyJson(e))};if(i.isHandleMessage(e)){var o=void 0,d=void 0;i.isHandleMessageWithId(e)?o=e.handle_id:i.isHandleMessageWithSender(e)&&(o=e.sender),void 0!==o&&void 0!==(d=this.handles.get(o))?d.receive(e):t()}else t()},t.prototype.detachHandle=function(e){var s=this,i={session_id:this.sessionId,janus:"detach",handle_id:e.handleId};return this.send(i).then(function(i){s.logIncoming("plugin handle detached "+e.handleId+", resp "+n.prettifyJson(i)),s.handles.delete(e.handleId)})},t.prototype.keepSessionAlive=function(){var e=this;setInterval(function(){e.send({janus:"keepalive",session_id:e.sessionId})},15e3)},t.prototype.logIncoming=function(e){console.debug("JANUS => session "+this.sessionId+" => "+e)},t.prototype.logOutgoing=function(e){console.debug("JANUS <= session "+this.sessionId+" <= "+e)},t}();exports.Session=t;
},{"./Janus":"7Tpe","./PluginHandle":"RJfL","../utils":"UnXq","./types/Messages":"IHrt"}],"7Tpe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.janus=void 0;var e=require("./Constants"),n=require("../utils"),s=require("./Session"),t=require("./types/Messages"),o=require("../elements"),i=function(){function i(){this.activeReqs=new Map,this.sessions=new Map}return i.prototype.createSession=function(){var e=this;return exports.janus.send({janus:"create"}).then(function(n){var t=new s.Session(n.data.id);return console.log("created new session "+t.sessionId),e.sessions.set(t.sessionId,t),t})},i.prototype.send=function(e){var s=this;e.transaction=n.tid(),this.logOutgoing(n.prettifyJson(e));var t=new Promise(function(t,o){s.activeReqs.set(e.transaction,new r(t,o)),setTimeout(function(){o("request "+e.transaction+" timed out, body: "+n.prettifyJson(e))},i.DEFAULT_TIMEOUT_MILLIS)});return this.ws().then(function(n){return n.send(JSON.stringify(e))}).then(function(e){return t})},i.prototype.ws=function(){return this.wsPromise?this.wsPromise:(this.wsPromise=this.createWS(),this.wsPromise)},i.prototype.createWS=function(){var s=this,t=new WebSocket(e.JANUS_WS,"janus-protocol"),o=new Promise(function(e,o){t.onopen=function(){return s.logOutgoing("JANUS <=> CONNECTED"),e(t)},t.onclose=function(e){s.logOutgoing("JANUS <~> DISCONNECTED"),s.wsPromise=void 0},t.onmessage=function(e){s.logIncoming(n.prettifyJson(e.data)),s.receive(e.data)},t.onerror=function(e){console.error("JANUS <~> error",e)},setTimeout(function(){o("socket connection timed-out")},i.DEFAULT_TIMEOUT_MILLIS)});return o.catch(function(e){console.error("janus ws connection failed, reason: ",e,". resetting!"),s.logOutgoing("JANUS <~> DISCONNECTED"),s.wsPromise=void 0}),o},i.prototype.reconnectToJanus=function(){var e=this;this.wsPromise=this.createWS(),this.sessions.forEach(function(n,s){var t=new(function(){return function(){this.janus="claim",this.session_id=s}}());e.send(t).then(function(e){console.log("session "+s+" reclaimed after reconnection")})})},i.prototype.receive=function(e){var n=(e=JSON.parse(e)).transaction;if(n&&"event"!==e.janus)if(console.debug("rcvd response for transaction "+n),this.activeReqs.has(n)){var s=this.activeReqs.get(n);void 0!==s&&("error"===e.janus?s.reject(e.error):s.resolve(e),this.activeReqs.delete(n))}else this.handleMessage(e);else this.handleMessage(e)},i.prototype.handleMessage=function(e){if(t.isSessionMessage(e)){var s=e.session_id,o=this.sessions.get(s);void 0!==o?o.receive(e):console.error("rcvd msg for non-existing session "+s+", msg "+n.prettifyJson(e))}else console.error("unhandled msg "+n.prettifyJson(e))},i.prototype.logOutgoing=function(e){e="<=== sent: \n "+e,console.debug(e),o.signalLog(e)},i.prototype.logIncoming=function(e){e="===> rcvd: \n"+e,console.debug(e),o.signalLog(e)},i.DEFAULT_TIMEOUT_MILLIS=1e4,i}(),r=function(){return function(e,n){this.resolve=e,this.reject=n}}();exports.janus=new i;
},{"./Constants":"zye4","../utils":"UnXq","./Session":"9t1e","./types/Messages":"IHrt","../elements":"0xjy"}],"GpfA":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{a(r.next(e))}catch(e){o(e)}}function u(e){try{a(r.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,u)}a((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Publisher=void 0;var n=require("../webrtc/UserMedia"),r=require("../elements"),i=require("../utils"),o=function(){function o(e){this.room=e,window.publisher=this}return o.prototype.init=function(){return e(this,void 0,void 0,function(){var e;return t(this,function(t){switch(t.label){case 0:return e=this,[4,navigator.mediaDevices.getUserMedia(n.userMedia.mediaConstraints())];case 1:return e.localStream=t.sent(),window.localStream=this.localStream,this.displayLocalVideo(),[4,this.setupPluginHandle()];case 2:return t.sent(),[2,Promise.resolve()]}})})},o.prototype.displayLocalVideo=function(){r.localStreamVid.srcObject=this.localStream},o.prototype.setupPluginHandle=function(){return e(this,void 0,void 0,function(){var e,n=this;return t(this,function(t){switch(t.label){case 0:return e=this,[4,this.room.session.createHandle()];case 1:return e.handle=t.sent(),this.handle.setEventListener("event",o.makeHandleListener(function(e){return n.handleJanusEvent(e)})),this.handle.setEventListener("webrtcup",o.makeHandleListener(function(e){return n.handleWebrtcupEvent(e)})),this.handle.setEventListener("media",o.makeHandleListener(function(e){return n.handleMediaEvent(e)})),[4,this.handle.send({request:"join",ptype:"publisher",room:this.room.roomId,display:r.username.value||i.rUsername()})];case 2:return t.sent(),[2]}})})},o.prototype.publishFeed=function(){var r;return e(this,void 0,void 0,function(){var e,o,s,u=this;return t(this,function(t){switch(t.label){case 0:return this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.localStream&&(e=this.localStream).getTracks().forEach(function(t){var n;return null===(n=u.pc)||void 0===n?void 0:n.addTrack(t,e)}),[4,this.pc.createOffer({offerToReceiveAudio:!1,offerToReceiveVideo:!1})];case 1:return o=t.sent(),[4,this.pc.setLocalDescription(o)];case 2:return t.sent(),[4,null===(r=this.handle)||void 0===r?void 0:r.send({request:"publish",audio:void 0!==n.userMedia.audioDeviceId,video:void 0!==n.userMedia.videoDeviceId,data:!1},o)];case 3:return s=t.sent(),console.log("rcvd offer resp "+i.prettifyJson(s)),[2]}})})},o.prototype.handleJanusEvent=function(n){var o,s;return e(this,void 0,void 0,function(){var e,u=this;return t(this,function(t){switch(t.label){case 0:return"joined"!==(null==(e=null===(o=n.plugindata)||void 0===o?void 0:o.data)?void 0:e.videoroom)?[3,2]:(console.log("JOINED room "+this.room.roomId+", starting publish"),this.id=e.id,r.localStreamVid.setAttribute("pid",String(this.id)),[4,this.publishFeed()]);case 1:return t.sent(),[3,3];case 2:"event"===(null==e?void 0:e.videoroom)&&(void 0!==n.jsep&&"answer"===n.jsep.type&&(console.log("rcvd answer from janus"),null===(s=this.pc)||void 0===s||s.setRemoteDescription(n.jsep)),e.publishers&&(console.log("subscribing to ",e.publishers),e.publishers.forEach(function(e){return u.room.subscribe(e)})),console.log("rcvd event for publisher "+i.prettifyJson(n))),t.label=3;case 3:return[2,Promise.resolve()]}})})},o.prototype.handleWebrtcupEvent=function(n){var r;return e(this,void 0,void 0,function(){var e=this;return t(this,function(t){switch(t.label){case 0:return console.log("rcvd webrtcup "+i.prettifyJson(n)+"  on "+(null===(r=this.handle)||void 0===r?void 0:r.handleId)),[4,this.room.subscribeToAll()];case 1:return t.sent(),setInterval(function(){return e.showStats()},1e3),[2]}})})},o.prototype.handleMediaEvent=function(n){var r;return e(this,void 0,void 0,function(){return t(this,function(e){return console.log("rcvd media event "+i.prettifyJson(n)+"  on "+(null===(r=this.handle)||void 0===r?void 0:r.handleId)),[2]})})},o.makeHandleListener=function(e){return new(function(){function t(){}return t.prototype.onEvent=function(t){return e(t)},t}())},o.prototype.showStats=function(){return e(this,void 0,void 0,function(){return t(this,function(e){return[2]})})},o}();exports.Publisher=o;
},{"../webrtc/UserMedia":"zmNJ","../elements":"0xjy","../utils":"UnXq"}],"QTA/":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(o,i){function s(e){try{a(r.next(e))}catch(e){i(e)}}function c(e){try{a(r.throw(e))}catch(e){i(e)}}function a(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(s,c)}a((r=r.apply(e,n||[])).next())})},n=this&&this.__generator||function(e,n){var t,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=n.call(e,s)}catch(e){i=[6,e],r=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Subscriber=void 0;var t=require("../elements"),r=require("../utils"),o=function(){function o(e,n){this.room=e,this.info=n,this.pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]}),this.remoteStream=new MediaStream,this.setupPCEventListeners()}return o.prototype.init=function(){return e(this,void 0,void 0,function(){return n(this,function(e){return[2,this.setupPluginHandle()]})})},o.prototype.setupPluginHandle=function(){return e(this,void 0,void 0,function(){var e,t=this;return n(this,function(n){switch(n.label){case 0:return e=this,[4,this.room.session.createHandle()];case 1:return e.handle=n.sent(),this.handle.setEventListener("event",o.makeHandleListener(function(e){return t.handleJanusEvent(e)})),this.handle.setEventListener("webrtcup",o.makeHandleListener(function(e){return t.handleWebrtcupEvent(e)})),this.handle.setEventListener("media",o.makeHandleListener(function(e){return t.handleMediaEvent(e)})),this.handle.setEventListener("attached",o.makeHandleListener(function(e){return t.handleAttachedEvent(e)})),this.handle.setEventListener("hangup",o.makeHandleListener(function(e){return t.handleHangupEvent(e)})),[4,this.handle.send({request:"join",ptype:"subscriber",room:this.room.roomId,feed:this.info.id,audio:!0,video:!0,data:!1})];case 2:return n.sent(),[2]}})})},o.prototype.handleJanusEvent=function(t){var o,i;return e(this,void 0,void 0,function(){var e,s;return n(this,function(n){switch(n.label){case 0:return"attached"!==(null==(e=null===(o=t.plugindata)||void 0===o?void 0:o.data)?void 0:e.videoroom)?[3,6]:t.jsep?(console.log("rcvd attached for publisher "+r.prettifyJson(t)),[4,this.pc.setRemoteDescription(t.jsep)]):[3,5];case 1:return n.sent(),[4,this.pc.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})];case 2:return s=n.sent(),[4,null===(i=this.handle)||void 0===i?void 0:i.send({request:"start"},s)];case 3:return n.sent(),[4,this.pc.setLocalDescription(s)];case 4:n.sent(),n.label=5;case 5:return[3,7];case 6:console.log("rcvd unhandled subscriber event",t),n.label=7;case 7:return[2,Promise.resolve()]}})})},o.prototype.handleWebrtcupEvent=function(t){var o;return e(this,void 0,void 0,function(){return n(this,function(e){return console.log("rcvd webrtcup "+r.prettifyJson(t)+"  on "+(null===(o=this.handle)||void 0===o?void 0:o.handleId)),[2]})})},o.prototype.handleMediaEvent=function(t){var o;return e(this,void 0,void 0,function(){return n(this,function(e){return console.log("rcvd media event "+r.prettifyJson(t)+"  on "+(null===(o=this.handle)||void 0===o?void 0:o.handleId)),[2]})})},o.prototype.handleAttachedEvent=function(t){var o;return e(this,void 0,void 0,function(){return n(this,function(e){return console.log("rcvd attached event "+r.prettifyJson(t)+"  on "+(null===(o=this.handle)||void 0===o?void 0:o.handleId)),[2]})})},o.makeHandleListener=function(e){return new(function(){function n(){}return n.prototype.onEvent=function(n){return e(n)},n}())},o.prototype.setupPCEventListeners=function(){var e=this;this.pc.ontrack=function(n){console.error("REMOTE PC rcvd track from subscriber, track ",n),e.remoteStream.addTrack(n.track),t.remoteVideoDisplayer(String(e.info.id)).videoEl.srcObject=e.remoteStream,t.remoteVideoDisplayer(String(e.info.id)).info.textContent="name: "+e.info.display+"\nid: "+e.info.id},this.pc.onconnectionstatechange=function(n){console.error("REMOTE PC conn state change event",n," state is: ",e.pc.connectionState)},this.pc.onicecandidate=function(e){console.error("REMOTE PC new ice candidate",e)},this.pc.oniceconnectionstatechange=function(n){console.error("REMOTE PC ICE conn state change event",n," state is: ",e.pc.connectionState)},this.pc.onicecandidateerror=function(e){console.error("REMOTE PC ICE conn ERROR event ",e)},this.pc.onicegatheringstatechange=function(e){console.error("REMOTE PC ICE GATHERING event ",e)},this.pc.onnegotiationneeded=function(e){console.error("REMOTE PC NEGOTIATION needed ",e)},this.pc.onstatsended=function(e){console.error("REMOTE PC STATS event ",e)}},o.prototype.handleHangupEvent=function(e){return console.log("HANG UP FOR "+this.info.id+" ev: "+r.prettifyJson(e)),t.removeRemoteVid(String(this.info.id)),this.room.unsubscribe(this),Promise.resolve(void 0)},o}();exports.Subscriber=o;
},{"../elements":"0xjy","../utils":"UnXq"}],"C8Ob":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function u(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,u)}c((r=r.apply(t,e||[])).next())})},e=this&&this.__generator||function(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoRoom=void 0;var n=require("./Publisher"),r=require("./Subscriber"),i=function(){function i(t,e){this.session=t,this.roomId=e,this.publisher=new n.Publisher(this),this.subscribers=new Map}return i.prototype.subscribe=function(n){return t(this,void 0,void 0,function(){var t;return e(this,function(e){switch(e.label){case 0:return console.log("subscribing to "+n.display+":"+n.id),[4,(t=new r.Subscriber(this,n)).init()];case 1:return e.sent(),this.subscribers.set(n.id,t),[2]}})})},i.prototype.unsubscribe=function(t){this.subscribers.delete(t.info.id)},i.prototype.listParticipants=function(){var n;return t(this,void 0,Promise,function(){return e(this,function(t){return[2,null===(n=this.publisher.handle)||void 0===n?void 0:n.send({request:"listparticipants",room:this.roomId}).then(function(t){return t.plugindata.data.participants})]})})},i.prototype.init=function(){return t(this,void 0,Promise,function(){return e(this,function(t){return[2,this.publisher.init()]})})},i.prototype.subscribeToAll=function(){return t(this,void 0,void 0,function(){var t=this;return e(this,function(e){switch(e.label){case 0:return[4,this.listParticipants()];case 1:return e.sent().forEach(function(e){return t.subscribe(e)}),[2]}})})},i}();exports.VideoRoom=i;
},{"./Publisher":"GpfA","./Subscriber":"QTA/"}],"7QCb":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))(function(r,o){function u(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(u,a)}c((i=i.apply(e,n||[])).next())})},n=this&&this.__generator||function(e,n){var t,i,r,o,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,i=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(r=(r=u.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){u.label=o[1];break}if(6===o[0]&&u.label<r[1]){u.label=r[1],r=o;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(o);break}r[2]&&u.ops.pop(),u.trys.pop();continue}o=n.call(e,u)}catch(e){o=[6,e],i=0}finally{t=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("./webrtc/UserMedia"),i=require("./utils"),r=require("./elements"),o=require("./janus/Janus"),u=require("./video-room/VideoRoom"),a=require("./janus/Constants");function c(){return e(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:return[4,t.userMedia.audioInDevices()];case 1:return e=n.sent(),[4,t.userMedia.videoDevices()];case 2:return i=n.sent(),e.forEach(function(e){var n=document.createElement("option");n.text=e.label||"Audio device "+e.deviceId,n.value=e.deviceId,r.audioSelect.appendChild(n)}),i.forEach(function(e){var n=document.createElement("option");n.text=e.label||"Video device "+e.deviceId,n.value=e.deviceId,r.videoSelect.appendChild(n)}),t.userMedia.audioDeviceId=r.audioSelect.value,t.userMedia.videoDeviceId=r.videoSelect.value,r.audioSelect.onchange=function(){return t.userMedia.audioDeviceId=r.audioSelect.value},r.videoSelect.onchange=function(){return t.userMedia.videoDeviceId=r.videoSelect.value},[2]}})})}function l(){return e(this,void 0,void 0,function(){return n(this,function(e){return[2,o.janus.createSession().then(function(e){return new u.VideoRoom(e,a.TEST_ROOM_ID).init()})]})})}window.addEventListener("load",function(){r.username.value=i.rUsername(),r.hideEl(r.progressBar),c()}),r.joinBtn.onclick=function(){null===t.userMedia.videoDeviceId&&null===t.userMedia.audioDeviceId?alert("select atleast one of audio or video devices to proceed"):(r.unhideEl(r.progressBar),l().then(function(){console.log("All set, rendering video room"),r.hideEl(r.constraintsDiv),r.hideEl(r.progressBar),r.unhideEl(r.roomDiv),r.unhideEl(r.statsDiv)}).catch(function(e){console.log("error in setting up room "+e),alert("error in setting up room. check console and reload to try again")}))};
},{"./webrtc/UserMedia":"zmNJ","./utils":"UnXq","./elements":"0xjy","./janus/Janus":"7Tpe","./video-room/VideoRoom":"C8Ob","./janus/Constants":"zye4"}]},{},["7QCb"], null)
//# sourceMappingURL=src.d2c6e2c2.map